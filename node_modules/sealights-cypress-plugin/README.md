# sealights-cypress-plugin

**sealights-cypress-plugin** is a custom plugin for the Cypress testing framework that enhances your testing capabilities by providing additional support for various tasks and configurations. <br>
This plugin adds support for Sealights, reporting coverage and test skipping as well.

## Supported Node / Cypress versions

- Node >= 12
- Cypress >= 9

## Features

- **Support File:** The plugin introduces a support file, it is automatically loaded before each test, providing a centralized location to manage the Sealights information and execute the required hooks

- **Config File:** The config file empowers the Cypress tests run by adding the required tasks and communicates with Sealights

## Installation

To use **sealights-cypress-plugin** in your Cypress project, follow these steps:

1. Install and Setup Cypress if you haven't already:

   ```bash
   npm install cypress --save-dev
   ```

2. Install the plugin from GitHub/npm
   ```bash
   npm install sealights-cypress-plugin
   ```

# Cypress v10+

In your `cypress.config.js` register the plugin:

```javascript
const { defineConfig } = require('cypress');
const { registerSealightsTasks } = require('sealights-cypress-plugin');

module.exports = defineConfig({
  e2e: {
    experimentalInteractiveRunEvents: true,
    testIsolation: false,
    setupNodeEvents(on, config) {
      registerSealightsTasks(on, config);
    },
  },
});
```

Add to your `cypress/support/e2e.js`:

```javascript
// This is your existing support/e2e.js file content
// ...

// Import sealights-cypress-plugin's support file
import 'sealights-cypress-plugin/support';
```

# Cypress v9

Add to your cypress/plugins/index.js file

```typescript
const { registerSealightsTasks } = require('sealights-cypress-plugin');

module.exports = (on, config) => {
  registerSealightsTasks(on, config);
  // IMPORTANT: return the config object
  // because the plugin might have changed it
  return config;
};
```

Add to your `cypress/support/index.js` file

```javascript
import 'sealights-cypress-plugin/support';
```

## Configuration

In order for the Sealights integration to work, three parameters have to be exported to the Cypress config.<br>
This can be done using environment variables and exposing them to Cypress. The three environment variables are:

```text
SL_BUILD_SESSION_ID // this or labId
SL_LAB_ID // this or buildSessionId
SL_TOKEN
SL_TEST_STAGE
```

For them to be available to Cypress, they have to be prefixed with `CYPRESS_`, for example:

```shell
export CYPRESS_SL_TOKEN={token}
export CYPRESS_SL_BUILD_SESSION_ID={buildSessionId}
export CYPRESS_SL_LAB_ID={labId}
export CYPRESS_SL_TEST_STAGE={your-test-stage}
```

More about defining the environment variables in Cypress at the following link:
https://docs.cypress.io/guides/guides/environment-variables
